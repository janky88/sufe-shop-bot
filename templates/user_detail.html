<!DOCTYPE html>
<html data-theme="light">
<head>
    <title>ç”¨æˆ·è¯¦æƒ… - å•†åŸæœºå™¨äººç®¡ç†ä¸­å¿ƒ</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="/static/css/theme.css?v=2">
    <link rel="stylesheet" href="/static/css/components.css?v=2">
    <link rel="stylesheet" href="/static/css/layout.css?v=1">
    <link rel="stylesheet" href="/static/css/pages/user-detail.css">
    <script>
    function logout() {
        fetch('/api/logout', { method: 'POST' })
            .then(() => window.location.href = '/')
            .catch(err => console.error('Logout failed:', err));
    }
    
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }).catch(err => {
            console.error('å¤åˆ¶å¤±è´¥:', err);
        });
    }
    </script>
    <link rel="stylesheet" href="/static/ui-enhancements.css">
</head>
<body class="page-container aurora-background">
    <div class="header">
        <div class="header-content">
            <div class="logo">å•†åŸæœºå™¨äººç®¡ç†ä¸­å¿ƒ</div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜ (Ctrl+Shift+T)">
                    <span class="theme-toggle-icon sun">â˜€ï¸</span>
                    <span class="theme-toggle-icon moon">ğŸŒ™</span>
                </button>
                <button class="btn btn-danger" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="nav">
            <a href="/admin/">ä»ªè¡¨ç›˜</a>
            <a href="/admin/products">å•†å“ç®¡ç†</a>
            <a href="/admin/orders">è®¢å•ç®¡ç†</a>
            <a href="/admin/users" class="active">ç”¨æˆ·ç®¡ç†</a>
            <a href="/admin/recharge-cards">å……å€¼å¡ç®¡ç†</a>
            <a href="/admin/broadcast">æ¶ˆæ¯æ¨é€</a>
            <a href="/admin/faq">FAQç®¡ç†</a>
            <a href="/admin/templates">æ¶ˆæ¯æ¨¡æ¿</a>
            <a href="/admin/tickets">å·¥å•ç®¡ç†</a>
            <a href="/admin/settings">ç³»ç»Ÿè®¾ç½®</a>
        </div>
        
        <div class="breadcrumb">
            <a href="/admin/users">ç”¨æˆ·ç®¡ç†</a> / {{.user.Username}}
        </div>
        
        <div class="user-info-card">
            <div class="user-header">
                <div class="user-basic-info">
                    <h1 class="user-name">{{.user.Username}}</h1>
                    <div class="user-id-display">ç”¨æˆ·ID: {{.user.ID}} | Telegram ID: {{.user.TgUserID}}</div>
                </div>
                <div class="user-balance-section">
                    <div class="balance-label">è´¦æˆ·ä½™é¢</div>
                    <div class="balance-value">{{.currency}}{{printf "%.2f" (divf .user.BalanceCents 100)}}</div>
                </div>
            </div>
            
            <div class="user-details-grid">
                    <div class="detail-item">
                        <label>æ³¨å†Œæ—¶é—´</label>
                        <span>{{.user.CreatedAt.Format "2006-01-02 15:04:05"}}</span>
                    </div>
                    <div class="detail-item">
                        <label>æœ€åæ´»è·ƒ</label>
                        <span>{{.user.UpdatedAt.Format "2006-01-02 15:04:05"}}</span>
                    </div>
                    <div class="detail-item">
                        <label>è®¢å•æ€»æ•°</label>
                        <span>{{.orderCount}}</span>
                    </div>
                    <div class="detail-item">
                        <label>æ¶ˆè´¹æ€»é¢</label>
                        <span>{{.currency}}{{printf "%.2f" (divf .totalSpent 100)}}</span>
                    </div>
            </div>
        </div>
        
        <div class="orders-section">
            <h2 class="section-title">è®¢å•è®°å½•</h2>
            <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>è®¢å•å·</th>
                        <th>å•†å“</th>
                        <th>é‡‘é¢</th>
                        <th>çŠ¶æ€</th>
                        <th>å¡å¯†</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                        <th>æ”¯ä»˜æ—¶é—´</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .orders}}
                    <tr>
                        <td><span class="order-id">#{{.ID}}</span></td>
                        <td>{{if .Product}}{{.Product.Name}}{{else}}ä½™é¢å……å€¼{{end}}</td>
                        <td class="order-amount">{{$.currency}}{{printf "%.2f" (divf .AmountCents 100)}}</td>
                        <td>
                            {{if eq .Status "pending"}}
                                <span class="order-status pending">å¾…æ”¯ä»˜</span>
                            {{else if eq .Status "paid"}}
                                <span class="order-status paid">å·²æ”¯ä»˜</span>
                            {{else if eq .Status "delivered"}}
                                <span class="order-status delivered">å·²å‘è´§</span>
                            {{else if eq .Status "paid_no_stock"}}
                                <span class="order-status paid_no_stock">ç¼ºè´§</span>
                            {{else if eq .Status "failed_delivery"}}
                                <span class="order-status failed_delivery">å‘è´§å¤±è´¥</span>
                            {{else if eq .Status "expired"}}
                                <span class="order-status expired">å·²è¿‡æœŸ</span>
                            {{else}}
                                <span class="order-status">{{.Status}}</span>
                            {{end}}
                        </td>
                        <td>
                            {{if .Code}}
                                <pre class="code-text" onclick="copyToClipboard('{{.Code.Code}}')" 
                                     title="ç‚¹å‡»å¤åˆ¶">{{.Code.Code}}</pre>
                            {{else}}
                                -
                            {{end}}
                        </td>
                        <td>{{.CreatedAt.Format "2006-01-02 15:04"}}</td>
                        <td>{{if .PaidAt}}{{.PaidAt.Format "2006-01-02 15:04"}}{{else}}-{{end}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
            </div>
        </div>
    </div>
    <script src="/static/theme.js"></script>
    <script src="/static/ui-enhancements.js"></script>
    <script>
        function toggleTheme() {
            if (window.themeManager) {
                window.themeManager.toggleTheme();
            }
        }
    </script>
</body>
</html>